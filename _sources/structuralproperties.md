# Structural Properties and Variational Integrators
For the treatment of constrained mechanical systems, its structural properties derived from the equations of motion are very important. In this section we will focus on the symplecticness of the flow generated by the equations of motions derived from the Livens principle to see the importance of integration methods preserving the symplecticity of the system:
{cite}`Kinon2023`

$$
\dot{q}=v, 
$$

$$
\frac{\partial L}{\partial q} = 
            \dot{p},
$$

$$
\frac{\partial L}{\partial v} = p
$$

## Conservation of Energy
The first important property is the conservation of energy in the system.
We know the energy function of a mechanical system is given as

$$
E(q,v,p) = p\cdot{v} - L(q,v)
$$

To assess the change of energy in the system we take the derivative with respect to time

$$
\frac{\partial E}{\partial t} = \dot{p}\cdot{v} - \frac{\partial L}{\partial q}\cdot{\dot{q}} + (p - \frac{\partial L}{\partial v})\cdot{\dot{v}}
$$

and when taking into account the Euler-Lagrange equations we get $\frac{\partial E}{\partial t} = 0$, which means that the energy in the system is conserved.

## Symplecticness of Flow
Now we want to check if the flow generated by the equations of motions is symplectic.
We therefore take the derivative of the wedge product with respect to time

$$
\frac{\partial}{\partial t}(dq \land dp) = \sum_{i=1}^{d}\frac{\partial}{\partial t}[dp_idq_i - dq_idp_i] = (d\dot{q} \land dp) + (dq \land d\dot{p})
$$

If we now make use of our equations and use the properties of the wedge product, we obtain

$
d\dot{q} = dv\\
$

$
d\dot{p} = \begin{pmatrix} \frac{\partial^2 L}{\partial q \partial q} & \frac{\partial^2 L}{\partial q \partial v}\end{pmatrix} \begin{pmatrix} dq\\ dv \end{pmatrix} = \frac{\partial^2 L}{\partial q \partial q}dq + \frac{\partial^2 L}{\partial q \partial v}dv
$

$
dp = \begin{pmatrix} \frac{\partial^2 L}{\partial v \partial q} & \frac{\partial^2 L}{\partial v \partial v}\end{pmatrix} \begin{pmatrix} dq\\ dv \end{pmatrix} = \frac{\partial^2 L}{\partial v \partial q}dq + \frac{\partial^2 L}{\partial v \partial v}dv
$


Furthermore the matrices $\frac{\partial^2 L}{\partial q \partial q} \frac{\partial^2 L}{\partial v \partial v}$ are symmetric, which leads us to

$$
\frac{\partial}{\partial t}(dq \land dp) = dv \land \frac{\partial^2 L}{\partial v \partial q}dq + dv \land \frac{\partial^2 L}{\partial v \partial v}dv + dq \land \frac{\partial^2 L}{\partial q \partial q}dq + dq \land \frac{\partial^2 L}{\partial q \partial v}dv
$$

The second and the third term vanish and we get

$$
\frac{\partial}{\partial t}(dq \land dp) = \frac{\partial^2 L}{\partial v \partial q}dv \land dq - \frac{\partial^2 L}{\partial q \partial v}dv \land dq = 0
$$

We now see that the flow of motion is symplectic which motivates the following definition of a symplectic procedure.

For a fixed step size $h$ and a procedure $\psi_h: \mathbb{R}^{2d} \rightarrow \mathbb{R}^{2d}: (q_n, p_n) \mapsto (q_{n+1}, p_{n+1})$
is symplectic if the map $\psi_h$ is symplectic.

## Variational Integrators
Variational integrators are used for approaches determining the equations of motions through a variational principle. As we based our approach on the Livens principle and constructed a variational integrator, we will give a general introduction to this kind of integrator.

When constructing varational integrators, we consider an action integral as given in {eq}`livens`:

$$
    \mathcal{S}(q,v,p) = \int_{t_0}^{T} L(q,v) + p(\dot{q}-v) \,dt.
$$

and try to approximate the integral with a discretization

$$
    \mathcal{S}_h((q_n)^{N}_0, (v_n)^{N}_0, (p_n)^{N}_0) = \sum_{i=1}^{N-1} L_h(q_i, v_i, p_i, q_{i+1}, v_{i+1}, p_{i+1})
$$

with q, v and p being the exact solutions of the Euler-Lagrange Equations and 

$$
L_h(q_n, v_n, p_n, q_{n+1}, v_{n+1}, p_{n+1}) \approx \int_{t_n}^{t_{n+1}} L(q,v) + p(\dot{q}-v) \,dt, \\
$$

$$
q_n = q(t_n),\ v_n = v(t_n),\ p_n = p(t_n)
$$

$$
q_{n+1} = q(t_{n+1}),\ v_{n+1} = v(t_{n+1}),\ p_{n+1} = p(t_{n+1})
$$
